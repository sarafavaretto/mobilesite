<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="google-site-verification" content="Uj7KUjZeJk7udEvuMw2IARbnOyZEoQKfECcyyNqdJE8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Form elements - jQuery Mobile Demos</title>
		<link rel="stylesheet" href="./css/themes/default/jquery.mobile-1.4.5.min.css">
		<link rel="stylesheet" href="./assets/css/jqm.css">
		<link rel="shortcut icon" href="./favicon.ico">
		<!--<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,700"-->
		<script src="./js/jquery.js"></script>
		<script src="./assets/js/index.js"></script>
		<script src="./js/jquery.mobile-1.4.5.min.js"></script>
		
<script type="text/javascript" src="https://apis.google.com/js/client.js"></script>
    <script type="text/javascript">
    </script>



	</head>
	<body>
		<div data-role="page" class="jqm-demos" data-quicklinks="true">

			<div data-role="header" class="jqm-header">
				<h2><a title="jQuery Mobile Demos home"><img src="./assets/img/scaruffi.png" alt="jQuery Mobile"></a></h2>
				</div><!-- /header -->

			<div role="main"  class="ui-content jqm-content">
			    <button id="logOut"  data-inline="true"  class="ui-btn ui-icon-delete ui-btn-icon-left ui-btn-inline ui-shadow ui-corner-all" onclick="goToPage('login')">Esci</button>
				<button id="tornaHome"  data-inline="true"  class="ui-btn ui-icon-home ui-btn-icon-left ui-btn-inline ui-shadow ui-corner-all" onclick="goToPage('sceltaAzione')">Indietro</button>
				<div id="login">
					<h1>Lista Panini</h1>

					<form id="loginForm" method="GET" action="./SceltaPanini.html">
		   
					
						<div data-demo-html="true">
							<label for="Username">Username:</label>
							<input type="text" required placeholder="Inserisci il tuo username" name="Username" id="Username" value="">

							<label for="Password">Password:</label>
							<input type="password" required name="Password" id="Password" value="" autocomplete="off">

							<button class="ui-shadow ui-btn ui-corner-all" >Login</button>
							<!--<button class="ui-shadow ui-btn ui-corner-all" onclick="window.location.href='./SceltaPanini.html?test=sara'" >Cambia Password</button>-->
							</div><!-- /demo-html -->

					</form>
				
				</div>
				<div id="sceltaPanini">
					<h1>Scelta Merende:</h1>
					<h3 id="nomeUtente"></h3>
					<h3 id="Classe"></h3>
					<form id="sceltaForm" method="POST" action="https://www.googleapis.com/fusiontables/v2/query/">
						<div data-demo-html="true">
							<div class="ui-field-contain">
								<label for="listaMerende">Merende:</label>
								<select required name="listaMerende" id="listaMerende">
									<option></option>
									<option value="1">Panino cotto</option>
									<option value="2">Panino crudo</option>
									<option value="3">Gnocco Salame</option>
									<option value="4">Gnocco prosciutto</option>
								</select>
							</div>
							<button class="ui-shadow ui-btn ui-corner-all" >Conferma</button>
							
						</div>
					</form>
				</div>
				<div id="sceltaAzione">
					<h3 id="nomeUtente"></h3>
					<h3 id="Classe"></h3>
					<button class="ui-shadow ui-btn ui-corner-all" onclick="goToPage('sceltaPanini')">Inserisci Richiesta Merenda</button>
					<button class="ui-shadow ui-btn ui-corner-all" onclick="goToPage('listaPanini')">Lista Panini Classe</button>
				</div>
				
				<div id="listaPanini">
				</div>
				</div><!-- /page -->
	
<script language="javascript">


$('#loginForm').submit(function(e) {
	e.preventDefault();
	var tableId = "1seiYS61e_U8ZBaZlBtcTsEFTp-MAv1WtJ-855z2t";
	var apiKey = "AIzaSyD8-PNgQ-IAE-scMuMV08McrQYtL2kIqq0";
	var sSql =  "SELECT%20*%20FROM%20"+ tableId +" where Username = '"+ $('#Username').val().toLowerCase() +"' and Password = '"+ $('#Password').val() +"'&key=" + apiKey;
	var queryurl = "https://www.googleapis.com/fusiontables/v1/query/?sql="+ sSql;

	$.getJSON( queryurl, function( data ) {
		if (data.rows == undefined){
			alert("Username o password errate");
			return false;
		}	
		else
		{
			alert("login avvenuto con successo");
			sessionStorage.Nome  = data.rows[0][3];
			sessionStorage.Cognome  = data.rows[0][4];
			sessionStorage.Classe  = data.rows[0][5];
			sessionStorage.Login = true;
			goToPage("sceltaAzione");
			
		}
	})

	return false;
});

$('#sceltaForm').submit(function(e) {
   	auth();
	return false;
});

//prende i dati passati in GET//
function getData(requestName){
	if (requestName = (new RegExp('[?&]'+encodeURIComponent(requestName)+'=([^&]*)')).exec(location.search))
	return decodeURIComponent(requestName[1]);
}


//Funzione eseguite al caricamento della pagina//
$(document).ready(function(){
	$("#contentTable" ).remove();
	switch (sessionStorage.Page){
		case "sceltaPanini":
			$("#login").css("display", "none");
			$("#listaPanini").css("display", "none");
			$("#sceltaAzione").css("display", "none");
			break;
		case "sceltaAzione":
			$("#tornaHome").css("display", "none");
			$("#login").css("display", "none");
			$("#listaPanini").css("display", "none");
			$("#sceltaPanini").css("display", "none");
			break;
		case "listaPanini":
		
			$("#login").css("display", "none");
			$("#sceltaAzione").css("display", "none");
			$("#sceltaPanini").css("display", "none");
			caricaListaPaniniClasse();		
		break;
		default:
			sessionStorage.Login = false;
			$("#tornaHome").css("display", "none");
			$("#logOut").css("display", "none");
			$("#listaPanini").css("display", "none");
			$("#sceltaPanini").css("display", "none");
			$("#sceltaAzione").css("display", "none");
		} 
	$("#nomeUtente").text("Utente: " + sessionStorage.Nome + " " + sessionStorage.Cognome);
	$("#Classe").text("Classe: " + sessionStorage.Classe);

});
	
function caricaListaPaniniClasse(){
	
	var tableId = "1pXmSJI53G1eS8eMBksdPF_f3QleXwnEbbQW0hGT6";
	var apiKey = "AIzaSyD8-PNgQ-IAE-scMuMV08McrQYtL2kIqq0";
	var sSql =  "SELECT NOME, COGNOME, SCELTA, PREZZO FROM%20"+ tableId +" where CLASSE = '"+ sessionStorage.Classe +"'&key=" + apiKey;
	var queryurl = "https://www.googleapis.com/fusiontables/v1/query/?sql="+ sSql;

	$.getJSON( queryurl, function( data ) {
		if (data.rows == undefined){
			return false;
		}	
		else
		{
			alert(data.rows.length)
			var htmlList; 
			htmlList ="";
				
			htmlList += "<div id ='contentTable' style='overflow:auto;'  class='ui-content jqm-content'>"
			htmlList +="	<h1>Lista Panini per la classe " + sessionStorage.Classe + "</h1>";
						
			htmlList += '<table data-role="table" data-mode="column" class="ui-body-d ui-shadow table-stripe ui-responsive"' +
							' data-column-btn-theme="a" >';
         	htmlList +='<thead><tr class="ui-bar-d">';
            var numCol = data.columns.length;
			for ( i= 0 ; i < numCol  ;i++){
				htmlList += "<th style='text-align:left'>"+ data.columns[i] + "</th>";
			}
			

			htmlList += "</tr></thead><tbody>";
			var price = 0 ;
			for ( i= 0 ; i< data.rows.length ;i++){
				htmlList += "<tr>";
				for ( j = 0 ; j < numCol ;j++){

					if (j == numCol - 1 ){
						//colonna prezzo
						htmlList += "<th style='text-align:right'>"+ data.rows[i][j] + "</th>";
						price = price + Number(data.rows[i][j]);
					}	
					else
					{
						htmlList += "<th style='text-align:left'>"+ data.rows[i][j] + "</th>";
					}
					
				}	
				htmlList += "</tr></tbody>";
			}
			htmlList += "<tr><th colspan=" + numCol+ "  style='text-align:right'>Tot: " + price.toString() + "</th></tr>"
			htmlList += "</tbody></table>";
			//htmlList += '<button id="tornaIndietro"  data-inline="true"  class="ui-btn ui-icon-back ui-btn-icon-left ui-btn-inline ui-shadow ui-corner-all" onclick="goToPage(\'sceltaAzione\')">Torna Indietro</button>';
			htmlList += "</div>";
				
			$("#listaPanini").html(htmlList) ;
		}
	})	
}


function goToPage(idPage){
	sessionStorage.Page  = idPage;
	window.location.href = window.location.href;

}



</script>
</body>
</html>

